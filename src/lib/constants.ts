/**
 * ==================== 常量定义模块 ====================
 * 
 * 功能说明：
 * - 定义应用中使用的所有常量
 * - 包括正则表达式、国家代码映射、区域关键词等
 * - 集中管理常量，便于维护和复用
 * 
 * ======================================================
 */

// ==================== 正则表达式 ====================

/**
 * HTTP/HTTPS 协议正则表达式
 * 用途：判断字符串是否以 http:// 或 https:// 开头
 * 使用场景：区分订阅链接和节点链接
 */
export const HTTP_REGEX = /^https?:\/\//;

/**
 * 节点协议正则表达式
 * 用途：匹配各种代理协议的链接格式
 * 支持的协议：
 * - ss (Shadowsocks)
 * - ssr (ShadowsocksR)
 * - vmess (V2Ray VMess)
 * - vless (V2Ray VLESS)
 * - trojan (Trojan)
 * - hysteria/hysteria2/hy/hy2 (Hysteria 协议)
 * - tuic (TUIC 协议)
 * - anytls (AnyTLS 协议)
 * - socks5 (SOCKS5 代理)
 */
export const NODE_PROTOCOL_REGEX = /^(ss|ssr|vmess|vless|trojan|hysteria2?|hy|hy2|tuic|anytls|socks5):\/\//;

// ==================== 国家/地区映射 ====================

/**
 * 国家/地区代码到旗帜和中文名称的映射表
 * 
 * 数据结构：
 * - 键：小写的国家/地区代码（ISO 3166-1 alpha-2）
 * - 值：数组 [旗帜emoji, 中文名称, 其他别名...]
 * 
 * 用途：
 * - 为节点名称添加国旗 emoji
 * - 识别节点所属地区
 * - 支持多种地区名称别名
 */
export const COUNTRY_CODE_MAP: Record<string, string[]> = {
    // 亚洲地区
    'hk': ['🇭🇰', '香港'],
    'tw': ['🇹🇼', '台湾', '臺灣'],
    'sg': ['🇸🇬', '新加坡', '狮城'],
    'jp': ['🇯🇵', '日本'],
    'kr': ['🇰🇷', '韩国', '韓國'],
    'cn': ['🇨🇳', '中国', '大陸', '内地'],
    'my': ['🇲🇾', '马来西亚', '馬來西亞'],
    'th': ['🇹🇭', '泰国', '泰國'],
    'vn': ['🇻🇳', '越南'],
    'ph': ['🇵🇭', '菲律宾', '菲律賓'],
    'id': ['🇮🇩', '印度尼西亚', '印尼'],
    'in': ['🇮🇳', '印度'],
    'pk': ['🇵🇰', '巴基斯坦'],
    'bd': ['🇧🇩', '孟加拉国', '孟加拉國'],

    // 中东地区
    'ae': ['🇦🇪', '阿联酋', '阿聯酋'],
    'sa': ['🇸🇦', '沙特阿拉伯'],
    'tr': ['🇹🇷', '土耳其'],
    'il': ['🇮🇱', '以色列'],
    'ir': ['🇮🇷', '伊朗'],
    'iq': ['🇮🇶', '伊拉克'],

    // 欧洲地区
    'gb': ['🇬🇧', '英国', '英國'],
    'de': ['🇩🇪', '德国', '德國'],
    'fr': ['🇫🇷', '法国', '法國'],
    'ru': ['🇷🇺', '俄罗斯', '俄羅斯'],
    'ua': ['🇺🇦', '乌克兰', '烏克蘭'],
    'pl': ['🇵🇱', '波兰', '波蘭'],
    'cz': ['🇨🇿', '捷克'],
    'hu': ['🇭🇺', '匈牙利'],
    'ro': ['🇷🇴', '罗马尼亚', '羅馬尼亞'],
    'gr': ['🇬🇷', '希腊', '希臘'],
    'pt': ['🇵🇹', '葡萄牙'],
    'es': ['🇪🇸', '西班牙'],
    'it': ['🇮🇹', '意大利'],
    'nl': ['🇳🇱', '荷兰', '荷蘭'],
    'be': ['🇧🇪', '比利时', '比利時'],
    'se': ['🇸🇪', '瑞典'],
    'no': ['🇳🇴', '挪威'],
    'dk': ['🇩🇰', '丹麦', '丹麥'],
    'fi': ['🇫🇮', '芬兰', '芬蘭'],
    'ch': ['🇨🇭', '瑞士'],
    'at': ['🇦🇹', '奥地利', '奧地利'],
    'ie': ['🇮🇪', '爱尔兰', '愛爾蘭'],

    // 美洲地区
    'us': ['🇺🇸', '美国', '美國'],
    'ca': ['🇨🇦', '加拿大'],
    'br': ['🇧🇷', '巴西'],
    'mx': ['🇲🇽', '墨西哥'],
    'ar': ['🇦🇷', '阿根廷'],
    'cl': ['🇨🇱', '智利'],

    // 大洋洲地区
    'au': ['🇦🇺', '澳大利亚', '澳洲', '澳大利亞'],
    'nz': ['🇳🇿', '新西兰', '紐西蘭'],

    // 非洲地区
    'za': ['🇿🇦', '南非'],
    'eg': ['🇪🇬', '埃及'],
    'ng': ['🇳🇬', '尼日利亚', '尼日利亞'],
    'ke': ['🇰🇪', '肯尼亚', '肯尼亞'],
};

// ==================== 辅助函数 ====================

/**
 * 根据搜索词获取国家/地区的所有相关词汇
 * 
 * 功能：支持反向查找，无论用户输入国家代码、中文名、繁体中文还是emoji，
 * 都能找到该国家的所有别名
 * 
 * @param searchTerm 搜索词（可以是国家代码、中文名、emoji等）
 * @returns 该国家/地区的所有相关词汇数组，如果未找到则返回空数组
 * 
 * @example
 * getCountryTerms('美国') // ['🇺🇸', '美国', '美國', 'us']
 * getCountryTerms('us')   // ['🇺🇸', '美国', '美國', 'us']
 * getCountryTerms('🇺🇸')  // ['🇺🇸', '美国', '美國', 'us']
 */
export function getCountryTerms(searchTerm: string): string[] {
    const lowerTerm = searchTerm.toLowerCase();

    // 1. 直接用国家代码查找（如 'us', 'hk'）
    if (COUNTRY_CODE_MAP[lowerTerm]) {
        return [...COUNTRY_CODE_MAP[lowerTerm], lowerTerm];
    }

    // 2. 反向查找：遍历所有国家，看搜索词是否匹配任何别名
    for (const [code, terms] of Object.entries(COUNTRY_CODE_MAP)) {
        // 检查搜索词是否在别名列表中（支持emoji、中文、繁体等）
        for (const term of terms) {
            if (term.toLowerCase() === lowerTerm) {
                // 找到匹配，返回该国家的所有别名 + 国家代码
                return [...terms, code];
            }
        }
    }

    // 3. 未找到匹配
    return [];
}

// ==================== 区域关键词 ====================

/**
 * 预定义区域关键词映射（用于节点排序）
 * 
 * 数据结构：
 * - 键：区域代码（大写）
 * - 值：正则表达式数组，用于匹配节点名称中的地区关键词
 * 
 * 用途：
 * - 识别节点所属地区
 * - 按地区对节点进行分组和排序
 * - 支持中文、英文、国家代码多种匹配方式
 */
export const REGION_KEYWORDS: Record<string, RegExp[]> = {
    HK: [/香港/, /HK/, /Hong Kong/i],
    TW: [/台湾/, /TW/, /Taiwan/i],
    SG: [/新加坡/, /SG/, /狮城/, /Singapore/i],
    JP: [/日本/, /JP/, /Japan/i],
    US: [/美国/, /US/, /United States/i],
    KR: [/韩国/, /KR/, /Korea/i],
    GB: [/英国/, /GB/, /UK/, /United Kingdom/i],
    DE: [/德国/, /DE/, /Germany/i],
    FR: [/法国/, /FR/, /France/i],
    CA: [/加拿大/, /CA/, /Canada/i],
    AU: [/澳大利亚/, /AU/, /Australia/i]
};

// ==================== 排序配置 ====================

/**
 * 区域排序优先级配置
 * 
 * 说明：
 * - 定义节点按地区排序时的先后顺序
 * - 数组前面的地区优先级更高
 * - 未在列表中的地区将排在最后
 * 
 * 排序规则：
 * 1. 香港（HK）- 距离近、速度快
 * 2. 台湾（TW）- 距离近、速度快
 * 3. 新加坡（SG）- 亚洲枢纽
 * 4. 日本（JP）- 亚洲常用节点
 * 5. 美国（US）- 国际常用节点
 * 6. 其他地区按字母顺序
 */
export const REGION_ORDER = ['HK', 'TW', 'SG', 'JP', 'US', 'KR', 'GB', 'DE', 'FR', 'CA', 'AU'];
